<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>삭제 가능한 웹 사운드보드</title>
<style>
   body {
     font-family: Arial, sans-serif;
     background: #f4f4f9;
     text-align: center;
     padding: 20px;
   }
   h1 { color: #333; }
   #buttons {
     display: flex;
     flex-wrap: wrap;
     justify-content: center;
     margin-top: 20px;
     gap: 10px;
   }
   .sound-item {
     display: flex;
     flex-direction: column;
     align-items: center;
   }
   .sound-btn {
     background: #4cafef;
     color: white;
     padding: 12px 16px;
     border: none;
     border-radius: 10px;
     cursor: pointer;
     font-size: 16px;
     transition: 0.2s;
     margin-bottom: 4px;
     min-width: 120px;
   }
   .sound-btn:hover { background: #388bcc; }
   .delete-btn, .rename-btn {
     margin: 2px;
     border: none;
     border-radius: 8px;
     padding: 6px 10px;
     cursor: pointer;
     font-size: 14px;
     color: white;
   }
   .delete-btn { background: #f44336; }
   .delete-btn:hover { background: #c62828; }
   .rename-btn { background: #ff9800; }
   .rename-btn:hover { background: #e65100; }
   .controls {
     margin-top: 20px;
   }
   .controls label { margin-right: 10px; }
   input[type="range"] { width: 150px; }
</style>
</head>
<body>
<h1>삭제 + 이름 변경 가능한 웹 사운드보드</h1>
<p>오디오 파일을 선택하세요 (여러 개 가능)</p>
<input type="file" id="fileInput" accept="audio/*" multiple>
<div id="buttons"></div>
<div class="controls">
<label>
     볼륨:
<input type="range" id="volumeControl" min="0" max="1" step="0.01" value="1">
</label>
<label>
<input type="checkbox" id="loopControl">
     반복 재생
</label>
</div>
<p style="margin-top: 10px; font-size: 14px; color: gray;">
   💡 키보드 단축키: 첫 번째 파일은 <b>1</b>, 두 번째 파일은 <b>2</b>, … 순서대로 재생
</p>
<script>
   const fileInput = document.getElementById("fileInput");
   const buttonsDiv = document.getElementById("buttons");
   const volumeControl = document.getElementById("volumeControl");
   const loopControl = document.getElementById("loopControl");
   let currentAudio = null;
   let audioList = [];

   // ------------------------
   // 파일 로드 및 버튼 생성
   // ------------------------
   function renderButtons() {
     buttonsDiv.innerHTML = "";
     audioList.forEach((a, index) => {
       const itemDiv = document.createElement("div");
       itemDiv.className = "sound-item";

       const btn = document.createElement("button");
       btn.className = "sound-btn";
       btn.textContent = `${index+1}. ${a.name}`;
       btn.addEventListener("click", () => playSound(a.url));

       const renameBtn = document.createElement("button");
       renameBtn.className = "rename-btn";
       renameBtn.textContent = "이름 변경";
       renameBtn.addEventListener("click", () => renameSound(index));

       const delBtn = document.createElement("button");
       delBtn.className = "delete-btn";
       delBtn.textContent = "삭제";
       delBtn.addEventListener("click", () => deleteSound(index));

       itemDiv.appendChild(btn);
       itemDiv.appendChild(renameBtn);
       itemDiv.appendChild(delBtn);
       buttonsDiv.appendChild(itemDiv);
     });
   }

   fileInput.addEventListener("change", (event) => {
     const files = event.target.files;
     loadFiles(files);
     saveFilesToStorage(files);
   });

   // ------------------------
   // 오디오 재생
   // ------------------------
   function playSound(url) {
     if (currentAudio) {
       currentAudio.pause();
       currentAudio.currentTime = 0;
     }
     currentAudio = new Audio(url);
     currentAudio.volume = volumeControl.value;
     currentAudio.loop = loopControl.checked;
     currentAudio.play();
   }

   // ------------------------
   // 볼륨 / 반복 설정
   // ------------------------
   volumeControl.addEventListener("input", () => {
     if (currentAudio) currentAudio.volume = volumeControl.value;
     localStorage.setItem("volume", volumeControl.value);
   });
   loopControl.addEventListener("change", () => {
     if (currentAudio) currentAudio.loop = loopControl.checked;
     localStorage.setItem("loop", loopControl.checked);
   });

   // ------------------------
   // 키보드 단축키
   // ------------------------
   document.addEventListener("keydown", (e) => {
     const num = parseInt(e.key);
     if (!isNaN(num) && num >= 1 && num <= audioList.length) {
       playSound(audioList[num - 1].url);
     }
   });

   // ------------------------
   // 이름 변경 기능
   // ------------------------
   function renameSound(index) {
     const newName = prompt("새 이름을 입력하세요:", audioList[index].name);
     if (newName && newName.trim() !== "") {
       audioList[index].name = newName.trim();
       saveAudioListToStorage();
       renderButtons();
     }
   }

   // ------------------------
   // 삭제 기능
   // ------------------------
   function deleteSound(index) {
     audioList.splice(index, 1);
     saveAudioListToStorage();
     renderButtons();
   }

   // ------------------------
   // LocalStorage 저장/불러오기
   // ------------------------
   function loadFiles(files) {
     Array.from(files).forEach(file => {
       const reader = new FileReader();
       reader.onload = (e) => {
         audioList.push({ name: file.name.replace(/\.[^/.]+$/, ""), url: URL.createObjectURL(file), data: e.target.result });
         saveAudioListToStorage();
         renderButtons();
       };
       reader.readAsDataURL(file);
     });
   }

   function saveFilesToStorage(files) {
     const fileData = [];
     let loadedCount = 0;
     Array.from(files).forEach(file => {
       const reader = new FileReader();
       reader.onload = (e) => {
         fileData.push({ name: file.name.replace(/\.[^/.]+$/, ""), data: e.target.result });
         loadedCount++;
         if (loadedCount === files.length) {
           localStorage.setItem("audioFiles", JSON.stringify(fileData));
         }
       };
       reader.readAsDataURL(file);
     });
   }

   function saveAudioListToStorage() {
     const data = audioList.map(a => ({ name: a.name, data: a.data }));
     localStorage.setItem("audioFiles", JSON.stringify(data));
   }

   function loadFilesFromStorage() {
     const stored = localStorage.getItem("audioFiles");
     if (stored) {
       const fileData = JSON.parse(stored);
       audioList = fileData.map(f => {
         const blob = dataURLtoBlob(f.data);
         return { name: f.name, url: URL.createObjectURL(blob), data: f.data };
       });
       renderButtons();
     }
     const storedVolume = localStorage.getItem("volume");
     if (storedVolume) volumeControl.value = storedVolume;
     const storedLoop = localStorage.getItem("loop");
     if (storedLoop) loopControl.checked = storedLoop === "true";
   }

   function dataURLtoBlob(dataurl) {
     const arr = dataurl.split(',');
     const mime = arr[0].match(/:(.*?);/)[1];
     const bstr = atob(arr[1]);
     let n = bstr.length;
     const u8arr = new Uint8Array(n);
     while(n--){
         u8arr[n] = bstr.charCodeAt(n);
     }
     return new Blob([u8arr], {type:mime});
   }

   window.onload = () => loadFilesFromStorage();
</script>
</body>
</html>
